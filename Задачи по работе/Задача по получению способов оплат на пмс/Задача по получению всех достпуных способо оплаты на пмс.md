ссылка на задачу: https://hivetaxi.atlassian.net/browse/HD-6877

Лоялти программа обязательна - т.е. ее надо использовать как-то в коде на пмс

Читать топик через который мы создаем и посмотреть как будет выглядеть файл с отправкой и можно просто свой установить

orderId - рандомное значение 
ClientId - uuid
profileId - посмотреть в базе


команда на создание заказа через кафку:

java -jar telltale.jar \

  bootstrap-servers=dev.regionlab.kz:9192 \

  topic=client-orders-payment \

  message=ClientOrderPaymentRequestEnvelope \

  mode=produce \

  json-file=/Users/region_008/Desktop/order.json



на прослушивание:

java -jar telltale.jar \                      

  bootstrap-servers=dev.regionlab.kz:9192 \

  topic=client-orders-payment \

  message=ClientOrderPaymentRequestEnvelope \

  mode=listen



ссылка на инструкцию по созданию заказа через кафку:
https://hivetaxi.atlassian.net/wiki/spaces/HIVETAXI/pages/1970405377/telltale+protobuf

создать заказ с новым способом оплаты отличным от наличного - 
карточки получить у пользователя в кассандре 
передаем id - сурогатный, а pan - клиентский способ оплаты


тест:
test("getOrderPaymentMethods should return useBonuses = false if payment method is Contractor") {  
  IO(dependencies()).flatMap { dependencies =>  
    val orderId = OrderId(orderIdPaymentPending)  
    for  
      paymentOpt <- dependencies.core.payments.findPayment(orderId)  
      payment    <- paymentOpt.liftTo[IO](OrderNotFound(orderId))  
      payment.paymentMethod  
      methods    <- dependencies.core.getOrderPaymentMethods(orderId)  
      _ <- IO {  
        val contractorDto = methods.find(_.id == orderIdReselectContractor)  
        assert(contractorDto.useBonuses, false)  
      }  
    yield ()  
  }  
}

inline given Validator[CreatePayment] with  
  override val validationChain: Seq[Validate] =  
    List(  
      createMsg =>  
        createMsg.paymentMethod.zip(createMsg.bonuses.flatMap(_.withdraw)).fold(createMsg.asRight[AppError]) {  
          (pm, useBonuses) =>  
            Either  
              .cond(  
                pm.kind === Contractor.show && useBonuses,  
                InvalidPaymentMethod("can't use bonuses with contractor"),  
                createMsg  
              )  
              .swap  
        },
не можем создать заказ с useBonuses с контрактором





